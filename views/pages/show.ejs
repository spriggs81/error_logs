<% include ../partials/header %>
    <div class="filtering">
        <h1>Here You!</h1>
    </div>
    <div class="tableRes">
      <table class="table table-striped table-dark">
        <thead>
          <div class="fulltab">
            <tr>
              <th>#</th>
              <th>Time:</th>
              <th>Name:</th>
              <th>Type:</th>
              <th>Component:</th>
              <th>Level:</th>
              <th>Message: </th>
            </tr>
          </div>
        </thead>
        <tbody>
          <% let n = 1; %>
          <% data.forEach(function(line){ %>
            <% let yy = line.time.slice(0,4) %>
            <% let mm = line.time.slice(5,7) %>
            <% let dd = line.time.slice(8,10) %>
            <% let hr = line.time.slice(11,13) %>
            <% let min = line.time.slice(14,16) %>
            <% let ss = line.time.slice(17,19) %>
            <% let ms = line.time.slice(20,23) %>
            <% let newTime = mm+'/'+dd+'/'+yy+' '+hr+':'+min+":"+ss+"."+ms %>
            <% let classes = line.type + " " + line.component + " h" + hr + " m" + min + " s"+ ss %>
            <% if(line.payload){classes += " pay"}else if(line.sqlQuery){classes += " sql"} %>
            <tr class='<%= classes + " no"+ n%> '>
              <th scope="row"><%= line.place %></th>
              <td><%= newTime %></td>
              <td><%= line.name %></td>
              <td><%= line.type %></td>
              <td><%= line.component %></td>
              <td><%= line.level %></td>
              <td><%= line.msg %></td>
            </tr>
            <% if(line.payload){ %>
              <tr class="<%= classes + " no"+ n+ " pay"+n%>">
                <td colspan="8">
                  Payload: {
                    <% for (const key of Object.keys(line.payload)) { %>
                      <% let val = line.payload[key] %>
                      <% if(typeof(val) === 'object'){ %>
                        <%= key+": { " %>
                        <% if(val === null){ %>
                          <%= null %>
                        <% } else {%>
                        <% for (const key1 of Object.keys(line.payload[key])) { %>
                          <% let val1 = line.payload[key][key1] %>
                          <% if(typeof(val1) === 'object'){ %>
                            <%= key1+": { " %>
                            <% if(val1 === null){ %>
                              <%= null %>
                            <% } else {%>
                            <% for (const key2 of Object.keys(line.payload[key][key1])) { %>
                              <% let val2 = line.payload[key][key1][key2] %>
                                <%= key2 + ": " + val2 %>
                            <% } %>
                              <%= "}" %>
                              <% } %>
                          <% } else { %>
                            <%=key1 +": "+val1+"," %>
                          <% } %>
                        <% } %>
                        <% } %>
                      <% } else { %>
                        <%= key +": "+val+"," %>
                      <% } %>
                      <% if(key == 'data'){ %>
                        <% line.payload[key].forEach(function(dataStuff){ %>
                          <%- dataStuff+"," %>
                        <% }) %>
                      <% } %>
                    <% } %>
                </td>
              </tr>
            <% } %>
            <% if(line.sqlQuery){ %>
              <tr class='<%= classes + " no"+ n+ " sql"+n%>'>
                <td colspan="7">SQL Query: <%= line.sqlQuery %></td>
              </tr>
            <% } %>
          <% n++ %>
        <% }) %>
        </tbody>
      </table>
    </div>
<% include ../partials/footer %>
